<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YT FunOw Admin — Styled + Deposit (Updated Firebase)</title>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  :root{
    --bg1:#0f172a; --bg2:#4c1d95; --accent:#8b5cf6; --accent2:#ec4899;
    --card: rgba(255,255,255,0.06); --glass: rgba(255,255,255,0.04);
    --success:#10b981; --danger:#e74c3c;
  }
  *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
  body{
    margin:0;min-height:100vh;background:linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 100%);
    color:#fff;padding:18px;
  }

  .wrap{max-width:980px;margin:0 auto;}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px;}
  .brand{display:flex;gap:12px;align-items:center;}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;box-shadow:0 8px 30px rgba(139,92,246,0.18);}
  h1{font-size:20px;margin:0}
  p.sub{opacity:0.85;margin:0;font-size:13px;color:#e6e6e6}

  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin:16px 0 22px;}
  .stat{background:var(--card);padding:16px;border-radius:12px;backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.03);transition:transform .22s ease, box-shadow .22s ease;}
  .stat:hover{transform:translateY(-6px);box-shadow:0 20px 40px rgba(0,0,0,0.35)}
  .stat small{display:block;color:#d1d5db;font-size:12px;margin-top:6px}
  .stat h2{font-size:22px;margin:0}

  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:14px;}
  .input, .select, .btn{padding:12px 14px;border-radius:10px;border:none;outline:none;font-size:15px;}
  input[type="tel"].input{width:220px;max-width:60%;background:var(--glass);color:#fff;text-align:center}
  select.select{background:var(--glass);color:#fff}
  button.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;cursor:pointer;box-shadow:0 10px 24px rgba(139,92,246,0.14);border-radius:10px}
  button.btn:active{transform:translateY(1px)}

  .list{margin-top:12px;display:grid;gap:12px}
  .card{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border-left:6px solid rgba(139,92,246,0.9);transition:transform .18s ease, box-shadow .18s ease;}
  .card:hover{transform:translateY(-6px);box-shadow:0 30px 60px rgba(0,0,0,0.4)}
  .left{display:flex;gap:12px;align-items:center;min-width:0}
  .avatar{width:56px;height:56px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px}
  .meta{min-width:0}
  .meta h3{margin:0;font-size:16px;word-break:break-all}
  .meta p{margin:4px 0 0;font-size:13px;color:#d1d5db}
  .right{display:flex;gap:8px;align-items:center}
  .small {font-size:13px;color:#e2e8f0}
  .balance{font-weight:700;color:var(--success);font-size:15px}
  .badge{background:#6b7280;padding:6px 10px;border-radius:10px;font-size:12px;color:#fff}

  .action{display:flex;gap:8px;align-items:center;}
  .btn-ghost{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;cursor:pointer}
  .btn-deposit{background:linear-gradient(90deg,#06b6d4,#3b82f6);color:#fff;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
  .btn-delete{background:var(--danger);color:#fff;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}

  @media (max-width:520px){
    .avatar{width:48px;height:48px;font-size:14px}
    input[type="tel"].input{width:100%}
    .controls{flex-direction:column;align-items:stretch}
    .right{flex-direction:column-reverse;gap:6px}
  }

  .fade-in{animation:fadeIn .45s ease both}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999}
  .modal{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:18px;border-radius:12px;max-width:360px;width:92%;box-shadow:0 30px 60px rgba(0,0,0,0.6)}
  .modal h4{margin:0 0 8px}
  .modal input{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:#fff}
  .modal .row{display:flex;gap:8px;margin-top:10px;justify-content:flex-end}
  .muted{color:#94a3b8;font-size:13px}
</style>
</head>
<body>
  <div class="wrap fade-in">
    <header>
      <div class="brand">
        <div class="logo">YT</div>
        <div>
          <h1>YT FunOw Admin (Updated Firebase)</h1>
          <p class="sub">Manage users • deposit • live stats (now on ultimatesurya Firebase)</p>
        </div>
      </div>

      <div style="text-align:right">
        <div style="font-size:13px;color:#e6e6e6">Signed in as <strong>Admin</strong></div>
        <div style="font-size:12px;color:#94a3b8;margin-top:6px">Realtime: <span id="nowTime">--</span></div>
      </div>
    </header>

    <div class="stats">
      <div class="stat">
        <h2 id="userCount">0</h2>
        <small>USERS</small>
      </div>
      <div class="stat">
        <h2 id="totalDeposit">₹0</h2>
        <small>TOTAL DEPOSIT (sum of lastdeposit)</small>
      </div>
      <div class="stat">
        <h2 id="totalBalance">₹0</h2>
        <small>TOTAL BALANCE (all users)</small>
      </div>
    </div>

    <div class="controls">
      <input id="mobile" class="input" type="tel" inputmode="numeric" maxlength="15" placeholder="Enter mobile/ID (3-15 digits)">
      <select id="brand" class="select">
        <option value="owner">Owner</option>
        <option value="user">User</option>
        <option value="agent">Agent</option>
      </select>
      <button class="btn" onclick="addUser()">Add Owner</button>
    </div>

    <div id="list" class="list"></div>
  </div>

  <div id="modalRoot" style="display:none;"></div>

<script>
/* ---------------- FIREBASE CONFIG (UPDATED to ultimatesurya project) ---------------- */
var firebaseConfig = {
  apiKey: "AIzaSyC90Zp34zKyQsIQRAmgVikI9WQ_gW4FWm0",
  authDomain: "ultimatesurya.firebaseapp.com",
  databaseURL: "https://ultimatesuryafunowner-default-rtdb.firebaseio.com",
  projectId: "ultimatesuryafunowner",
  storageBucket: "ultimatesuryafunowner.firebasestorage.app",
  messagingSenderId: "55012652176",
  appId: "1:55012652176:android:d0d70b50c332dca5af9415"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------------- small helpers ---------------- */
function escapeHtml(s){ if(s==null) return ""; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
function escapeJs(s){ if(s==null) return ""; return String(s).replace(/'/g,"\\'"); }
function fmtINR(n){ try{ return "₹"+Number(n).toLocaleString(); }catch(e){ return "₹0"; } }

const listEl = document.getElementById('list');
const userCountEl = document.getElementById('userCount');
const totalDepositEl = document.getElementById('totalDeposit');
const totalBalanceEl = document.getElementById('totalBalance');
const nowTimeEl = document.getElementById('nowTime');

function updateNowTime(){ nowTimeEl.textContent = new Date().toLocaleString('en-IN'); }
setInterval(updateNowTime,1000); updateNowTime();

/* listener */
db.ref('dbRef').on('value', snap => {
  const data = snap.val() || {};
  listEl.innerHTML = '';

  let totalUsers = 0;
  let sumLastDeposit = 0;
  let sumBalance = 0;
  // reverse keys if possible
  Object.keys(data).reverse().forEach(key => {
    const u = data[key];
    if(!u || !u.mobile) return;
    totalUsers++;

    const mobile = String(u.mobile);
    const brand = u.brand || 'user';
    const balanceNum = Number(u.balance || 0);
    const lastDepNum = Number(u.lastdeposit || 0);

    sumBalance += isFinite(balanceNum) ? balanceNum : 0;
    sumLastDeposit += isFinite(lastDepNum) ? lastDepNum : 0;

    const avatar = escapeHtml(mobile).slice(0,2).toUpperCase();
    const card = document.createElement('div');
    card.className = 'card fade-in';
    card.innerHTML = `
      <div class="left">
        <div class="avatar">${avatar}</div>
        <div class="meta">
          <h3>${escapeHtml(mobile)}</h3>
          <p class="small">Brand: <strong>${escapeHtml(brand)}</strong> • <span class="muted">Last: ${escapeHtml(u.time||'--')}</span></p>
          <p style="margin-top:6px" class="small">LastDeposit: <strong>${fmtINR(lastDepNum)}</strong> • Balance: <span class="balance">${fmtINR(balanceNum)}</span></p>
        </div>
      </div>

      <div class="right">
        <div class="action">
          <button class="btn-ghost" onclick="viewUser('${escapeJs(key)}')">View</button>
          <button class="btn-deposit" onclick="openDeposit('${escapeJs(key)}','${escapeJs(mobile)}')">Deposit</button>
          <button class="btn-delete" onclick="delUser('${escapeJs(key)}')">Delete</button>
        </div>
      </div>
    `;
    listEl.appendChild(card);
  });

  userCountEl.textContent = totalUsers;
  totalDepositEl.textContent = fmtINR(sumLastDeposit);
  totalBalanceEl.textContent = fmtINR(sumBalance);
});

/* ---------------- Add user (min 3 - max 15 digits) ---------------- */
function addUser(){
  const mobileEl = document.getElementById('mobile');
  const brandEl = document.getElementById('brand');
  const mobile = mobileEl.value.trim();
  const brand = brandEl.value || 'owner';

  const minLen = 3, maxLen = 15;
  const re = new RegExp(`^[0-9]{${minLen},${maxLen}}$`);
  if(!re.test(mobile)){
    alert("Number " + minLen + " se " + maxLen + " digits ke beech hona chahiye!");
    return;
  }

  const obj = { mobile: mobile, brand: brand, balance: "0", lastdeposit: "0", time: new Date().toLocaleString('en-IN') };
  db.ref('dbRef/'+mobile).set(obj)
    .then(()=>{ mobileEl.value=''; mobileEl.blur(); })
    .catch(e=>{ console.error(e); alert('Save failed'); });
}

/* ---------------- delete user ---------------- */
function delUser(key){
  if(!confirm('Delete karna hai?')) return;
  db.ref('dbRef/'+key).remove().catch(e=>{ console.error(e); alert('Delete failed'); });
}

/* ---------------- view user (simple popup) ---------------- */
function viewUser(key){
  db.ref('dbRef/'+key).once('value').then(s=>{
    const u = s.val();
    const html = `
      <div style="padding:8px 0">
        <div style="font-weight:700;margin-bottom:6px">${escapeHtml(u.mobile)}</div>
        <div class="muted">Brand: ${escapeHtml(u.brand||'user')}</div>
        <div style="margin-top:8px">Balance: <strong>${fmtINR(Number(u.balance||0))}</strong></div>
        <div style="margin-top:6px">Last Deposit: <strong>${fmtINR(Number(u.lastdeposit||0))}</strong></div>
        <div style="margin-top:8px;color:#cbd5e1">${escapeHtml(u.time||'--')}</div>
      </div>
    `;
    simpleModal('User Info', html, [{text:'Close',onClick:closeModal}]);
  });
}

/* ---------------- open deposit modal ---------------- */
function openDeposit(key, mobile){
  const body = `
    <div>
      <div class="muted">User: <strong>${escapeHtml(mobile)}</strong></div>
      <div style="margin-top:10px">
        <input id="depositAmt" type="number" placeholder="Enter deposit amount (₹)" />
        <div class="row" style="margin-top:12px">
          <button class="btn-ghost" onclick="closeModal()">Cancel</button>
          <button class="btn-deposit" onclick="confirmDeposit('${escapeJs(key)}')">Confirm</button>
        </div>
      </div>
    </div>
  `;
  simpleModal('Add Deposit', body, []);
}

/* ---------------- confirm deposit: save lastdeposit & update balance ---------------- */
function confirmDeposit(key){
  const amtEl = document.getElementById('depositAmt');
  if(!amtEl) return;
  const v = (''+amtEl.value).trim();
  if(v==='' || isNaN(v) || Number(v) <= 0){ alert('Valid deposit amount daalo!'); return; }
  const deposit = Number(v);

  const ref = db.ref('dbRef/'+key);
  ref.once('value').then(s=>{
    const u = s.val() || {};
    const oldBal = Number(u.balance || 0);
    const newBal = oldBal + deposit;

    ref.update({
      lastdeposit: String(deposit),
      balance: String(newBal),
      time: new Date().toLocaleString('en-IN')
    }).then(()=>{
      closeModal();
    }).catch(e=>{ console.error(e); alert('Deposit failed'); });
  }).catch(e=>{ console.error(e); alert('User read failed'); });
}

/* ---------------- modal helpers ---------------- */
function simpleModal(title, innerHtml, buttons){
  const root = document.getElementById('modalRoot');
  root.innerHTML = `
    <div class="modal-back" id="modalBack">
      <div class="modal fade-in">
        <h4>${escapeHtml(title)}</h4>
        <div>${innerHtml}</div>
      </div>
    </div>
  `;
  root.style.display = 'block';
}
function closeModal(){ const root = document.getElementById('modalRoot'); root.style.display = 'none'; root.innerHTML = ''; }
document.getElementById('mobile').addEventListener('keydown', function(e){ if(e.key === 'Enter') addUser(); });
</script>

</body>
</html>
